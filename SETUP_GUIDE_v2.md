# Laihdutanyt v2.1.0 - Setup and Migration Guide

**Technical Name:** `laihdutanyt_setup_migration_guide_v2_1_0.md`  
**Version:** v2.1.0  
**Date:** 2025-12-20  
**Status:** Ready to Execute


## Current Status Check

### Status:

  **Python 3.11.9** - Installed and working   
  **poetry.lock** - EXISTS (created by Poetry 2.2.1, valid)  
  **pyproject.toml** - EXISTS and updated to v2.1.0  
  **Database** - EXISTS at `src/data/laihdutanyt.db`  
  **Migration Script** - EXISTS at `src/migrations/migrate_to_v2_1.py`

### What This Means:

1. **poetry.lock contains locked dependency versions
2. **Database exists** - Migration can be run after Poetry setup
3. **You're ready to proceed** - Just need to install Poetry


## SETUP CHECKLIST

###   STEP 1: Install Poetry

#### Method A: Official Installer (RECOMMENDED)

(Invoke-WebRequest -Uri https://install.python-poetry.org -UseBasicParsing).Content | python -

#### Method B: Using pip

pip install poetry

**Verify Installation:**

poetry --version
 - Should show: Poetry (version 2.x.x)

**If Command Not Found:**
```powershell
# Add Poetry to PATH (Windows):
# 1. Find Poetry location:
Get-ChildItem -Path $env:APPDATA -Recurse -Filter "poetry.exe" -ErrorAction SilentlyContinue

# 2. Add to PATH manually or restart terminal
# Poetry is usually installed to: %APPDATA%\Python\Scripts\poetry.exe
```

###   STEP 2: Install Project Dependencies

# Navigate to project root

# Install all dependencies from poetry.lock
poetry install

# This will install:
# - cowsay (main dependency)
# - pytest, pytest-cov (testing)
# - pylint (code quality)
# - invoke (task automation)

**What Happens:**
- Poetry reads `poetry.lock`
- Creates a virtual environment automatically
- Installs exact versions specified in lock file

**Expected Output:**

Creating virtualenv laihdutanyt-xxx in ...
Installing dependencies from lock file
Package operations: X installs, 0 updates, 0 removals
  â€¢ Installing ...
  ...
Installing the current project: laihdutanyt (2.1.0)

###   STEP 3: Verify Installation

# Check virtual environment
poetry env info

# List installed packages
poetry show

# Test invoke tasks
poetry run invoke --list

**Expected Result:**
You should see list of available tasks like e.g.:
- start
- lint
- init-db

###   STEP 4: Run Database Migration

# Run the migration script
poetry run python src/migrations/migrate_to_v2_1.py

**Expected Output:**
Starting database migration to v2.1...
  Creating weightlog table...
  âœ“ weightlog table created
  Adding column total_kcal_burned to statistics...
  âœ“ Column total_kcal_burned added
  Adding column net_kcal to statistics...
  âœ“ Column net_kcal added
  Adding column total_carbs_g to statistics...
  âœ“ Column total_carbs_g added
  Adding column total_protein_g to statistics...
  âœ“ Column total_protein_g added
  Adding column total_fat_g to statistics...
  âœ“ Column total_fat_g added
  Creating index on statistics...
  âœ“ Index idx_statistics_user_date created
âœ“ Migration completed successfully!

Verifying migration...
  âœ“ weightlog table exists
  âœ“ All 5 new columns exist in statistics
âœ“ Migration verification passed!

âœ“ Database is ready for v2.1!

###   STEP 5: Test the Application

# Run the application
poetry run python src/main.py

**What to Check:**
1. Login window appears
2. User can log in or register

## Common Issues and Solutions

### Issue 1: "poetry: command not found"

# Find where Poetry was installed
$env:APPDATA\Python\Scripts\poetry.exe --version

# If it works, add to PATH:
# Win11 Settings â†’ System â†’ Environment Variables
# Add: C:\Users\YourName\AppData\Roaming\Python\Scripts

### Issue 2: "poetry install" fails with SSL error

# Use pip method instead
pip install poetry
poetry install

### Issue 3: Migration shows "table already exists"

The migration script is safe to run multiple times.

**Output will show:**

  âœ“ weightlog table already exists
  âœ“ Column total_kcal_burned already exists

### Issue 4: "Database locked"

# Close the application if running
# Wait 5 seconds
# Try migration again

### Issue 5: Import errors after migration

# Ensure you're running Python via Poetry's virtual environment
poetry run python src/main.py

# NOT just:
# python src/main.py

## About poetry.lock

### What is poetry.lock?

**DO NOT DELETE THIS!**

`poetry.lock` is automatically generated by Poetry and contains:
- Exact versions of all dependencies
- Checksums for security
- Dependency resolution results

**Reasons:**
  **Reproducibility** - Everyone gets same versions  
  **Security** - Checksums verify package integrity  
  **Stability** - Prevents "works on my machine" issues  
  **Speed** - Poetry doesn't need to resolve dependencies again

### When Does It Change?

Only when:
- `poetry add <package>` - Add new dependency
- `poetry update` - Update all packages to latest
- `poetry update <package>` - Update specific package
- `poetry remove <package>` - Remove dependency

### Git and poetry.lock

**Always commit poetry.lock to Git!**

git add poetry.lock
git commit -m "Update dependencies"

## Order of Operations Summary

1. Install Poetry (one-time)
   â†“
2. Run `poetry install` (installs from poetry.lock)
   â†“
3. Run migration script (one-time for v2.1)
   â†“
4. Test application

**DO NOT:**
-  Delete poetry.lock
-  Edit poetry.lock manually
-  Run migration before Poetry install
-  Use system Python directly (always use `poetry run`)

**DO:**
-   Install Poetry first
-   Run `poetry install` before anything else
-   Always use `poetry run` for Python commands
-   Commit poetry.lock to Git

## Verification Commands

After completing all steps, verify everything works:

# 1. Check Poetry
poetry --version
# Expected: Poetry (version 2.x.x)

# 2. Check virtual environment
poetry env info
# Should show Python 3.10+ and virtualenv path

# 3. Check installed packages
poetry show --tree
# Should show all dependencies

# 4. Check database schema
poetry run python -c "import sqlite3; 
conn = sqlite3.connect('src/data/laihdutanyt.db'); 
cur = conn.cursor(); 
cur.execute('SELECT name FROM sqlite_master WHERE type=\"table\"'); 
print([t[0] for t in cur.fetchall()]); 
conn.close()"
# Should include 'weightlog' in output

# 6. Start application
poetry run python src/main.py
# Application should launch

## ðŸ“š Next Steps After Setup

Once setup is complete:

### 1. Generate Demo Data (Optional)

poetry run python src/scripts/generate_demo_data.py

## Need Help?

### Quick Reference Files:
1. **Poetry basics**: `dokumentaatio/POETRY_INVOKE_GUIDE.md`
2. **Implementation plan**: `dokumentaatio/MVP_RELEASE_PLAN_v2.1.md`
3. **Requirements**: `dokumentaatio/statistics_requirements_v3.md`
4. **Naming conventions**: `dokumentaatio/NAMING_CONVENTIONS.md`

### Troubleshooting Steps:
1. Check Poetry is in PATH: `poetry --version`
2. Check virtual environment: `poetry env info`
3. Reinstall dependencies: `poetry install --no-cache`
4. Check database: `ls src/data/`
5. Check Python version: `python --version` (should be 3.10+)

##   Success Criteria

Setup is complete when:

- [ ] `poetry --version` works
- [ ] `poetry install` completes without errors
- [ ] `poetry run invoke --list` shows tasks
- [ ] Migration script runs successfully
- [ ] Database has `weightlog` table
- [ ] Application launches: `poetry run python src/main.py`

**Guide Version:** 1.0  
**Last Updated:** 2025-12-20  
**Tested On:** Windows 11, Python 3.11.9, Poetry 2.2.1
